# CCNP IGRP
Interior Gateway Routing Protocol

# Convergence, 收斂的方法

* Split Horizon Update, 水平分割更新法

(移除不正確資訊)

 水平分割使指閘道器會紀錄所接收到的路徑資訊是由哪一個網路介面而來的，同時不可將此路徑傳回給同樣的網路介面，避免造成迴圈。
 
 當 GW 1 （ RouterC E0 ）和 Net 1 中斷時，GW 2 (Router A s0) 經由 GW 1 到達 Net 1 時，距離為 2，一旦中斷，GW 2 不會再對 GW 1 廣播這條路徑，GW 1 也停止廣播此網路至 Net 1 的路徑，經過幾回合路徑更新後，各個閘道會發現此網路 Net 1 是 unreachabel，便不會造成迴圈了。
 
 路由器 A 和 路由器 B 的 192.168.4.0 這網段是由路由器 C 所學習來的，所以不會反向更新路徑。
 
                                               
                                                
                                  Router A           
                                  
                                     GW2
                                 s0      s1
                                 /         \
                 192.168.1.0    /           \  192.168.3.0
                               /             \
                              /               \
                            s1   s0 ----- s1   s0    
                                                
                                 192.168.2.0
                                                       GW1
                       Router B             Router C    E0 ---X--- E0  Router D
                       
                                                         192.168.4.0
                       
                       
    +--------------------------+                  
    |      Routing Table A     |
    +--------------------------+
    |    IP     | Int | Metric |   
    +-----------+-----+--------+
    |192.168.1.0| s0  |    0   |
    +-----------+-----+--------+
    |192.168.3.0| s1  |    0   |
    +-----------+-----+--------+
    |192.168.2.0| s0  |    1   |
    +-----------+-----+--------+
    |192.168.4.0| s0  |    2   |
    +-----------+-----+--------+
    
    
    +--------------------------+                  
    |      Routing Table B     |
    +--------------------------+
    |    IP     | Int | Metric |   
    +-----------+-----+--------+
    |192.168.1.0| s1  |    0   |
    +-----------+-----+--------+
    |192.168.2.0| s0  |    0   |
    +-----------+-----+--------+
    |192.168.3.0| s0  |    1   |
    +-----------+-----+--------+
    |192.168.4.0| E0  |    1   |
    +-----------+-----+--------+
    
    
    +--------------------------+                  
    |      Routing Table C     |
    +--------------------------+
    |    IP     | Int | Metric |   
    +-----------+-----+--------+
    |192.168.2.0| s1  |    0   |
    +-----------+-----+--------+
    |192.168.3.0| s0  |    0   |
    +-----------+-----+--------+
    |192.168.1.0| s1  |    1   |
    +-----------+-----+--------+
    |192.168.4.0| E0  |  down  |
    +-----------+-----+--------+
    
    
    +--------------------------+                  
    |      Routing Table D     |
    +--------------------------+
    |    IP     | Int | Metric |   
    +-----------+-----+--------+
    |192.168.4.0| E0  | 0/down |
    +-----------+-----+--------+
    
 
 
    
* Poison Reverse + * Triggered Updates, 毒性逆向 ＋ 觸發更新

(移除不正確資訊)

此法規定原本最先廣播該路徑的 GW 遇到路徑中斷時，必須將路徑修改至無限長 (= 16)，此資訊亦將保留若干週期。觸發更新則是當閘道器收到故障通知時，會立刻廣播，不會等到下一個路徑更新時方才廣播。

實際觀察路由表變化，來知曉 Poison Reverse 的運作機制，倘若 路由器 C 介面 E0 線路中斷， metric 值會變成 infinite，路由器 B 會送 Poison Reverse 給路由器 C ，告知此網段無法存取 unaccessable。

    
   
      
    +--------------------------+                  
    |      Routing Table B     |
    +--------------------------+
    |    IP     | Int | Metric |   
    +-----------+-----+--------+
    |192.168.1.0| s1  |    0   |
    +-----------+-----+--------+
    |192.168.2.0| s0  |    0   |
    +-----------+-----+--------+
    |192.168.3.0| s0  |    1   |
    +-----------+-----+--------+
    |192.168.4.0| E0  |infinite|
    +-----------+-----+--------+
    
    
    +--------------------------+                  
    |      Routing Table C     |
    +--------------------------+
    |    IP     | Int | Metric |   
    +-----------+-----+--------+
    |192.168.2.0| s1  |    0   |
    +-----------+-----+--------+
    |192.168.3.0| s0  |    0   |
    +-----------+-----+--------+
    |192.168.1.0| s1  |    1   |
    +-----------+-----+--------+
    |192.168.4.0| E0  |infinite|
    +-----------+-----+--------+
 
 
   
* Hold Down Timer, 倒數計時更新法

（防止迴路）

此更新方式是用來解決故障資訊比正當資訊傳送的慢的問題，原理是讓故障資訊保持充足時間傳送，當閘道器收到此網路 unreachable 時，一定時間內，例如 60 秒內，閘道器不會再接收關於這網路的路徑資訊。

缺點是，此法會造成迴圈，使得網路效率大減。

可見實際路由表變化，來觀察 Hold Down Timer 的運作機制，當路由器 C 介面 E0 線路中斷後，介面 E0 的 metric 值改成 down，並且通知路由器 B，再通知路由器 A，AB 都在 Holddown 時間過後，方才更新路由表。


                                                
                                  Router A           
                                  
                                     GW2
                                 s0      s1
                                 /         \
                 192.168.1.0    /           \  192.168.3.0
                               /             \
                              /               \
                            s1   s0 ----- s1   s0    
                                                
                                 192.168.2.0
                                                       GW1
                       Router B             Router C    E0 ---X--- E0  Router D
                       
                                                         192.168.4.0
                       
                        
    +--------------------------+                  
    |      Routing Table A     |
    +--------------------------+
    |    IP     | Int | Metric |   
    +-----------+-----+--------+
    |192.168.1.0| s0  |    0   |
    +-----------+-----+--------+
    |192.168.3.0| s1  |    0   |
    +-----------+-----+--------+
    |192.168.2.0| s0  |    1   |
    +-----------+-----+--------+
    |192.168.4.0| s0  |    2   |
    +-----------+-----+--------+
    
    
    +--------------------------+                  
    |      Routing Table B     |
    +--------------------------+
    |    IP     | Int | Metric |   
    +-----------+-----+--------+
    |192.168.1.0| s1  |    0   |
    +-----------+-----+--------+
    |192.168.2.0| s0  |    0   |
    +-----------+-----+--------+
    |192.168.3.0| s0  |    1   |
    +-----------+-----+--------+
    |192.168.4.0| E0  |    1   |
    +-----------+-----+--------+
    
    
    +--------------------------+                  
    |      Routing Table C     |
    +--------------------------+
    |    IP     | Int | Metric |   
    +-----------+-----+--------+
    |192.168.2.0| s1  |    0   |
    +-----------+-----+--------+
    |192.168.3.0| s0  |    0   |
    +-----------+-----+--------+
    |192.168.1.0| s1  |    1   |
    +-----------+-----+--------+
    |192.168.4.0| E0  |  down  |
    +-----------+-----+--------+
    
    
    +--------------------------+                  
    |      Routing Table D     |
    +--------------------------+
    |    IP     | Int | Metric |   
    +-----------+-----+--------+
    |192.168.4.0| E0  | 0/down |
    +-----------+-----+--------+
    


# IGRP = Cisco RIP

距離向量的，distance vector，然而與 RIP 不同之處在於：

(1) 不受限於 15 個 hops，適用於大型互聯網路。

(2) 提供 4 個路徑，藉以節省頻寬。

(3) 每 90 秒廣播一次。

(4) 不支援 VLSM。


# IGRP 的參考用參數

(影響 metric value/hops count)

1. Bandwidth 頻寬

2. Delay 時間

3. Load 負載

4. MTU 最大傳送單元（傳輸位元組）

5. Reliability 可靠度、可信度（距離值越小越可靠）

# 預設的距離值

      +--------+---------------+
      | 路由方  |  distance val |
      +--------+---------------+
      | int    |       0       |
      +--------+---------------+
      | static |       1       |
      +--------+---------------+
      | EIGRP  |      5 /90    |
      +--------+---------------+
      |  BGP   |       20      |
      +--------+---------------+
      |        |               |
      |  IGRP  |      100      |
      |        |               |
      +--------+---------------+
      |  OSPF  |      110      |
      +--------+---------------+
      |  IS-IS |      115      |
      +--------+---------------+
      |   RIP  |      120      |
      +--------+---------------+
      |   EGP  |      140      |
      +--------+---------------+
      |    ?   |      255      |
      +--------+---------------+

# RIP

此為 Xerox 所開發的通訊協定，使用向量距離或是經過的閘道數 Hops Count 作為距離單位。此協定將閘道器分為主動的廣播和被動的收聽，同一時間下，一閘道器主動，則其餘閘道器皆為被動，以避免廣播風暴。

向量距離不能保證最短的路徑最快，因為線路的材質也會影響速度，例如乙太網路線和其他慢速網路線的相互比較，而且路徑訊息可能在傳輸過程中發生錯誤，需要在每個收聽的閘道器上設有 timer 計時器，每當收到廣播閘道器的廣播資訊時，便開始倒數 180 秒 （3分鐘）若沒有收到同樣的路徑資訊，便視此路徑資訊無效。

被動的閘道器不廣播，根據主動的閘道所廣播的路徑訊息調整自己的路由表（路徑表）。

# Broadcast Storm

https://zh.wikipedia.org/wiki/廣播風暴

